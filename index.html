<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guidelines Tool</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      margin: 0;
      height: 100vh;
    }
    .left-pane {
      width: 200px;
      background: #f0f0f0;
      padding: 1em;
      overflow-y: auto;
      border-right: 1px solid #ccc;
    }
    .main-content {
      flex: 1;
      padding: 1em;
      overflow-y: auto;
    }
    .tabs {
      margin-bottom: 1em;
    }
    .tab-button {
      padding: 0.5em 1em;
      margin-right: 0.5em;
      cursor: pointer;
    }
    .tab-button.active {
      background: #007bff;
      color: white;
    }
    .category-title {
      margin-top: 1em;
      font-weight: bold;
    }
    .guideline-item {
      display: flex;
      align-items: center;
      gap: 0.5em;
      margin: 0.2em 0;
    }
    .copy-symbol {
      cursor: pointer;
      color: #007bff;
    }
    .buttons {
      margin-top: 1em;
    }
    .toast {
      position: fixed;
      bottom: 1em;
      right: 1em;
      background: #333;
      color: white;
      padding: 0.5em 1em;
      border-radius: 5px;
      display: none;
    }
    .toast.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="left-pane">
    <h2>Extra Links</h2>
    <ul id="extra-links"></ul>
  </div>

  <div class="main-content">
    <div class="tabs">
      <button class="tab-button active" data-type="business">Business</button>
      <button class="tab-button" data-type="company">Company</button>
    </div>

    <div class="guideline-container"></div>

    <div class="buttons">
      <button id="copyButton" aria-label="Copy selected guidelines">Copy Selected Guidelines</button>
      <button id="clearButton" aria-label="Clear selection">Clear Selection</button>
    </div>
  </div>

  <div id="toast" class="toast">Copied to clipboard!</div>

  <script>
    async function loadJSON(url) {
      const response = await fetch(url);
      return response.json();
    }

    function renderGuidelines(guidelines) {
      const container = document.querySelector('.guideline-container');
      container.innerHTML = '';
      guidelines.forEach(category => {
        const title = document.createElement('div');
        title.className = 'category-title';
        title.textContent = category.category;
        container.appendChild(title);

        category.items.forEach(guideline => {
          const item = document.createElement('div');
          item.className = 'guideline-item';
          item.innerHTML = `
            <input type="checkbox" id="${guideline.id}" aria-label="Select ${guideline.description}" value="${guideline.description}: ${guideline.link}">
            <label for="${guideline.id}">${guideline.description}</label>
            <a href="${guideline.link}" target="_blank">(Link)</a>
            <span class="copy-symbol" onclick="copySingleGuideline('${guideline.description}: ${guideline.link}')">ðŸ“„</span>
            <span class="selection-number"></span>
          `;
          item.querySelector('input[type="checkbox"]').addEventListener('change', handleCheckboxChange);
          container.appendChild(item);
        });
      });
    }

    function renderExtraLinks(extraLinks) {
      const container = document.querySelector('#extra-links');
      container.innerHTML = '';
      extraLinks.forEach(link => {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${link.link}" target="_blank">${link.name}</a>`;
        container.appendChild(li);
      });
    }

    let selectedOrder = [];

    function handleCheckboxChange(e) {
      const checkbox = e.target;
      const id = checkbox.id;
      const item = checkbox.closest('.guideline-item');
      const number = item.querySelector('.selection-number');

      if (checkbox.checked) {
        selectedOrder.push(id);
        number.textContent = `#${selectedOrder.length}`;
      } else {
        selectedOrder = selectedOrder.filter(x => x !== id);
        number.textContent = '';
        document.querySelectorAll('.guideline-item').forEach((el, i) => {
          const cb = el.querySelector('input[type="checkbox"]');
          const span = el.querySelector('.selection-number');
          if (cb.checked) {
            span.textContent = `#${selectedOrder.indexOf(cb.id) + 1}`;
          }
        });
      }
    }

    function handleCopy() {
      const selected = selectedOrder.map(id => {
        const checkbox = document.getElementById(id);
        return checkbox.value;
      });
      const text = selected.join('\n');
      navigator.clipboard.writeText(text);
      showToast();
    }

    function handleClear() {
      selectedOrder = [];
      document.querySelectorAll('.guideline-item input[type="checkbox"]').forEach(cb => cb.checked = false);
      document.querySelectorAll('.selection-number').forEach(span => span.textContent = '');
    }

    function copySingleGuideline(text) {
      navigator.clipboard.writeText(text);
      showToast();
    }

    function showToast() {
      const toast = document.getElementById('toast');
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    async function loadGuidelines(type = 'business') {
      const linkFile = type === 'company' ? 'company-links.json' : 'business-links.json';
      const extraFile = type === 'company' ? 'company-extra.json' : 'business-extra.json';

      try {
        const guidelines = await loadJSON(linkFile);
        renderGuidelines(guidelines);

        const extraData = await loadJSON(extraFile);
        renderExtraLinks(extraData.extraLinks);
      } catch (error) {
        console.error(`Failed to load ${type} data:`, error);
      }
    }

    function initTabs() {
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          const type = button.dataset.type;
          loadGuidelines(type);
        });
      });
    }

    function init() {
      initTabs();
      loadGuidelines('business');
      document.getElementById('copyButton').addEventListener('click', handleCopy);
      document.getElementById('clearButton').addEventListener('click', handleClear);
    }

    init();
  </script>
</body>
</html>
