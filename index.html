<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guideline Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            background-color: #f4f4f4;
            color: #333;
        }
        .left-pane {
            width: 160px;
            background-color: #2c3e50;
            color: #fff;
            padding: 10px;
        }
        .left-pane h2 {
            font-size: 16px;
            text-align: center;
            margin: 0 0 10px;
        }
        .left-pane ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .left-pane ul li a {
            color: #fff;
            text-decoration: none;
            font-size: 13px;
            display: block;
            padding: 5px;
        }
        .main-content {
            flex: 1;
            padding: 10px;
            max-width: 580px;
            margin: 0 auto;
        }
        .guideline-container {
            background-color: #fff;
            padding: 10px;
            margin-bottom: 60px;
        }
        .category-title {
            font-size: 18px;
            color: #3498db;
            margin: 10px 0;
        }
        .guideline-item {
            display: flex;
            align-items: center;
            padding: 8px;
            font-size: 13px;
        }
        .guideline-item input[type="checkbox"] {
            margin-right: 8px;
        }
        .guideline-item label {
            flex: 1;
        }
        .guideline-item a {
            color: #3498db;
            text-decoration: none;
        }
        .buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
        }
        .buttons button {
            padding: 8px 16px;
            font-size: 13px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin: 0 5px;
        }
        #copyButton {
            background-color: #3498db;
            color: white;
        }
        #clearButton {
            background-color: #e74c3c;
            color: white;
        }
        .toast {
            display: none;
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 8px;
            border-radius: 3px;
            margin: 10px auto;
            width: 180px;
            font-size: 13px;
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
        }
        .toast.show {
            display: block;
            animation: fadeInOut 2.5s;
        }
        .mode-selector {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            background-color: #fff;
            padding: 10px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .mode-selector label {
            margin-right: 10px;
            font-size: 13px;
            white-space: nowrap;
        }
        .mode-selector select {
            padding: 5px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .current-mode {
            font-weight: bold;
            color: #3498db;
            font-size: 13px;
            white-space: nowrap;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="left-pane">
        <h2>Extra Links</h2>
        <ul id="extra-links"></ul>
    </div>
    <div class="main-content">
        <div class="mode-selector">
            <label>I'm sending guidelines for:</label>
            <select id="modeSelector">
                <option value="business">Business Name</option>
                <option value="company">Company</option>
                <option value="agent">Agent</option>
            </select>
            <span class="current-mode" id="modeIndicator">Business Name Mode</span>
        </div>
        <div class="guideline-container" id="guidelineContainer"></div>
        <div class="buttons">
            <button id="copyButton">Copy Selected</button>
            <button id="clearButton">Clear Selection</button>
        </div>
        <div id="toast" class="toast"></div>
    </div>

    <script>
        // Global variables
        let currentMode = 'business';
        const modeData = {
            business: {
                name: 'Business Name',
                linksFile: 'business-links.json',
                extraFile: 'business-extra.json'
            },
            company: {
                name: 'Company',
                linksFile: 'company-links.json',
                extraFile: 'company-extra.json'
            },
            agent: {
                name: 'Agent',
                linksFile: 'agent-links.json',
                extraFile: 'agent-extra.json'
            }
        };

        // DOM elements
        const modeSelector = document.getElementById('modeSelector');
        const modeIndicator = document.getElementById('modeIndicator');
        const guidelineContainer = document.getElementById('guidelineContainer');
        const extraLinksContainer = document.getElementById('extra-links');
        const copyButton = document.getElementById('copyButton');
        const clearButton = document.getElementById('clearButton');
        const toast = document.getElementById('toast');

        // Initialize the application
        async function init() {
            setupEventListeners();
            await loadModeData(currentMode);
        }

        // Set up event listeners
        function setupEventListeners() {
            modeSelector.addEventListener('change', handleModeChange);
            copyButton.addEventListener('click', handleCopy);
            clearButton.addEventListener('click', handleClear);
        }

        // Handle mode change
        async function handleModeChange(event) {
            currentMode = event.target.value;
            await loadModeData(currentMode);
        }

        // Load data for the selected mode
        async function loadModeData(mode) {
            try {
                showLoading();
                const modeInfo = modeData[mode];
                modeIndicator.textContent = `${modeInfo.name} Mode`;
                
                const [guidelines, extraLinks] = await Promise.all([
                    fetchData(modeInfo.linksFile),
                    fetchData(modeInfo.extraFile)
                ]);
                
                renderGuidelines(guidelines);
                renderExtraLinks(extraLinks);
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Failed to load data!', 'error');
            }
        }

        // Fetch JSON data
        async function fetchData(file) {
            const response = await fetch(file);
            if (!response.ok) throw new Error(`Failed to load ${file}`);
            return await response.json();
        }

        // Render guidelines
        function renderGuidelines(guidelines) {
            guidelineContainer.innerHTML = '';
            
            if (!Array.isArray(guidelines)) {
                console.error('Invalid guidelines data:', guidelines);
                return;
            }
            
            guidelines.forEach(category => {
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = category.category;
                guidelineContainer.appendChild(categoryTitle);
                
                category.items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'guideline-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = item.id;
                    checkbox.value = `${item.description}: ${item.link}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = item.id;
                    label.textContent = item.description;
                    
                    const link = document.createElement('a');
                    link.href = item.link;
                    link.target = '_blank';
                    link.textContent = '(Link)';
                    
                    itemDiv.appendChild(checkbox);
                    itemDiv.appendChild(label);
                    itemDiv.appendChild(link);
                    guidelineContainer.appendChild(itemDiv);
                });
            });
        }

        // Render extra links
        function renderExtraLinks(extraData) {
            extraLinksContainer.innerHTML = '';
            
            if (!extraData?.extraLinks) {
                console.error('Invalid extra links data:', extraData);
                return;
            }
            
            extraData.extraLinks.forEach(link => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = link.link;
                a.target = '_blank';
                a.textContent = link.name;
                li.appendChild(a);
                extraLinksContainer.appendChild(li);
            });
        }

        // Handle copy button click
        async function handleCopy() {
            const checkedItems = document.querySelectorAll('.guideline-item input:checked');
            
            if (checkedItems.length === 0) {
                showToast('No guidelines selected!', 'warning');
                return;
            }
            
            try {
                const itemsHtml = Array.from(checkedItems)
                    .map((item, index) => {
                        const [desc, link] = item.value.split(': ');
                        return `${index + 1}. <a href="${link.trim()}" target="_blank">${desc}</a>`;
                    })
                    .join('<br>');
                
                await navigator.clipboard.write([
                    new ClipboardItem({
                        'text/html': new Blob([itemsHtml], { type: 'text/html' })
                    })
                ]);
                
                showToast(`${checkedItems.length} guideline(s) copied!`, 'success');
            } catch (error) {
                console.error('Copy failed:', error);
                showToast('Failed to copy!', 'error');
            }
        }

        // Handle clear button click
        function handleClear() {
            document.querySelectorAll('.guideline-item input').forEach(checkbox => {
                checkbox.checked = false;
            });
            showToast('Selection cleared', 'info');
        }

        // Show toast message
        function showToast(message, type = 'info') {
            toast.textContent = message;
            toast.className = 'toast show';
            
            // Remove any existing type classes
            toast.classList.remove('info', 'success', 'warning', 'error');
            
            // Add the appropriate type class
            toast.classList.add(type);
            
            // Hide after delay
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // Show loading state
        function showLoading() {
            guidelineContainer.innerHTML = '<div style="text-align: center; padding: 20px;">Loading...</div>';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>