<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex" />
  <title>Guideline Selector</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f2f5;
    }

    .header {
      background: #0077cc;
      color: white;
      padding: 1em;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .dropdown-container {
      display: flex;
      justify-content: center;
      margin: 1em;
    }

    select {
      font-size: 16px;
      padding: 0.5em;
      border-radius: 5px;
      border: 1px solid #aaa;
    }

    .mode-heading {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      margin: 1em 0;
      color: #2c3e50;
    }

    .guideline-container {
      max-width: 900px;
      margin: auto;
      padding: 1em;
    }

    .category {
      background: #e0e0e0;
      padding: 10px;
      margin-top: 20px;
      border-radius: 6px;
      font-weight: bold;
    }

    .guideline-item {
      display: flex;
      align-items: center;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 8px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .guideline-item input {
      margin-right: 10px;
    }

    .guideline-item.copying {
      background: #d1ffd1;
      border-color: #5cb85c;
    }

    .selection-number {
      background: #0077cc;
      color: white;
      padding: 0 6px;
      border-radius: 50%;
      margin-left: auto;
      font-weight: bold;
      display: none;
    }

    .controls {
      text-align: center;
      margin: 1.5em 0;
    }

    .controls button {
      padding: 0.7em 1.5em;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      background-color: #e74c3c;
      color: white;
      cursor: pointer;
    }

    .loading {
      text-align: center;
      margin-top: 2em;
      font-size: 18px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Guideline Selector</h1>
  </div>

  <div class="dropdown-container">
    <label for="modeSelect" style="margin-right: 0.5em; font-weight: bold;">I'm sending links for</label>
    <select id="modeSelect">
      <option value="business">Business Name Mode</option>
      <option value="company">Company Mode</option>
      <option value="agent">Agent Mode</option>
    </select>
  </div>

  <div class="mode-heading" id="modeHeading">Business Name Mode</div>

  <div class="guideline-container"></div>

  <div class="controls">
    <button id="clearButton">Clear Selection</button>
  </div>

  <script>
    const guidelineContainer = document.querySelector('.guideline-container');
    const clearButton = document.getElementById('clearButton');
    const modeSelect = document.getElementById('modeSelect');
    const modeHeading = document.getElementById('modeHeading');

    let currentMode = 'business';
    let selectedOrder = [];

    function updateModeHeading() {
      modeHeading.textContent =
        currentMode === 'business' ? 'Business Name Mode' :
        currentMode === 'company' ? 'Company Mode' :
        'Agent Mode';
    }

    function clearContent() {
      guidelineContainer.innerHTML = '';
      selectedOrder = [];
    }

    function createGuidelineItem(item) {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'guideline-item';

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';

      const label = document.createElement('label');
      label.textContent = item.description;
      label.style.cursor = 'pointer';
      label.style.flex = '1';

      const numberSpan = document.createElement('span');
      numberSpan.className = 'selection-number';

      itemDiv.appendChild(checkbox);
      itemDiv.appendChild(label);
      itemDiv.appendChild(numberSpan);

      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          navigator.clipboard.writeText(item.link);
          selectedOrder.push(item.id);
          itemDiv.classList.add('copying');
        } else {
          selectedOrder = selectedOrder.filter(id => id !== item.id);
          itemDiv.classList.remove('copying');
        }
        updateNumbers();
      });

      return itemDiv;
    }

    function updateNumbers() {
      const items = document.querySelectorAll('.guideline-item');
      items.forEach(item => {
        const checkbox = item.querySelector('input');
        const numberSpan = item.querySelector('.selection-number');
        const labelText = item.querySelector('label').textContent;

        if (checkbox.checked) {
          const id = labelText;
          const index = selectedOrder.indexOf(item.querySelector('input').nextSibling.textContent);
          numberSpan.textContent = index + 1;
          numberSpan.style.display = 'inline-block';
        } else {
          numberSpan.textContent = '';
          numberSpan.style.display = 'none';
        }
      });
    }

    async function loadData(mode) {
      clearContent();

      const linkFile = `${mode}-links.json`;
      const extraFile = `${mode}-extra.json`;

      try {
        const [linksRes, extraRes] = await Promise.all([
          fetch(linkFile),
          fetch(extraFile)
        ]);

        if (!linksRes.ok || !extraRes.ok) throw new Error("Failed to fetch");

        const linkData = await linksRes.json();
        const extraData = await extraRes.json();

        const combined = [...linkData, ...extraData];

        combined.forEach(category => {
          const categoryDiv = document.createElement('div');
          categoryDiv.className = 'category';
          categoryDiv.textContent = category.category;
          guidelineContainer.appendChild(categoryDiv);

          category.items.forEach(item => {
            const itemDiv = createGuidelineItem(item);
            guidelineContainer.appendChild(itemDiv);
          });
        });
      } catch (error) {
        console.error('Failed to load data:', error);
        guidelineContainer.innerHTML = '<div class="loading">Failed to load guidelines</div>';
      }
    }

    modeSelect.addEventListener('change', () => {
      currentMode = modeSelect.value;
      updateModeHeading();
      loadData(currentMode);
    });

    clearButton.addEventListener('click', () => {
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
        checkbox.closest('.guideline-item').classList.remove('copying');
        checkbox.closest('.guideline-item').querySelector('.selection-number').style.display = 'none';
      });
      selectedOrder = [];
    });

    // Initial load
    updateModeHeading();
    loadData(currentMode);
  </script>
</body>
</html>
